#!/bin/bash

# 1. Install System Tools (Compilers + Python + Simulator)
# Added 'build-essential' to ensure you have C++ compilers for Verilator
sudo apt update
sudo apt install build-essential python3-venv python3-dev verilator -y

# 2. Go to the project
cd ~/c_projects/division_risc-/divider

# 3. Setup Python Environment (Only creates it if it doesn't exist)
if [ ! -d "soc_env" ]; then
    echo "Creating virtual environment..."
    python3 -m venv soc_env

source soc_env/bin/activate

# 4. Activate & Install Libraries
source soc_env/bin/activate
pip install --upgrade pip
pip install "cocotb<2.0" pytest cocotb-test

# 5. Run the Test
echo "Running Simulation..."
pytest testbench.py -k "test_1iter or test_divider"